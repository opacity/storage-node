sudo: required

language: go

go:
 - "1.11.4"

env:
  matrix:
  - DOCKER_COMPOSE_VERSION=1.18.0 GO111MODULE=on
  global:
  - DISPLAY_NAME=travisBuild
  - ENABLE_JOBS=false
  - SLACK_DEBUG_URL=""
  - DISABLE_DB_CONN=false
  - ACCOUNT_RETENTION_DAYS=7
  # ETH_NODE_URL
  - secure: RGi02glpOcLUxzvdxbgIsHEekxaMXNOpD7tsM1uVvMe7I1qtfBEJlKTUPcT4Nsx9CTew7XvDzRTSVVnfGmWJH/FGk0PFO8yLZfW8z4Vxq1PI4ttRmv8ul1nkcgRHY5e6sebNPW4xNnjJ0pz3OEQDcvUy+bTGmDbc6WoWctxpxHoxi1nEN1zL/Xu+Tn/p4Ddz8UujZwjz0ag3fUQ7CKogf/1fh7/yJ0xTg/7/d4NDY7BCvOY7HBCRGdUMHoNZ6wnhMGsEykF+Q4bUty7dIfgrOhBkR8zuyPdHySC6XDhkG1POjkkYXvEYFhT/B1ROyyiuX01N1lx94kMbcV7PZs90YJtK0R8KDvUfD99kFDhN/cb6qErZ7nH1idW8vJwcay4sbKXa2Mf/4hA5Vl7agmAZyCASmPaPzsDC0eX2SZb5JxHUfXByAR4M7EW8QY62TL8LFtDqIN1nlCKpB3GkH0ADQK0iHXp9f9gAnIqbUXbfYzy+2CwPOMdUl8+ed1VAS16rlPfGp8sq1NjBolIJznVzYqMedNjtCil6E36dN0gYIHrtDXbJjIouhp4t6g+pflFi3ES15CcY1RBSjqZT/ERQ817DzZWcJ9Ff/loVTaEpRJI+MJMQ9Jq8eSn7XEInSa+n9T1MGVce/f7cYp4iYOUOhefEyjIbY9m6Yp3XYTDEM8s=
  # TOKEN_CONTRACT_ADDRESS
  - secure: Dor08qHJYOo42v7HvmORtYDiLKj95rGXREp41VzEeBybCB9GV08x6ckJkq9kUJyKzCeOylh900FRxwWch6WgfujfSy8eJXvUUnNwgwrjD67Na33CSdDij5Bed/3AoCNyeWVwWmhifKAoSNhtVW0NAI+PPLcw2d9MMVpDZt+kin1rBZVY/TVyXfk48eLSPGjOjZd/QRo/ufk18EEJ9lraL1yEqoNA9iWQt9uRzWymDSB6aU3ULybuE8RJ5ckAgqd5KhdYEUsFWxV7RxiLmRS9KNOwy9tGxiZR5va3e2a8iWNNl0kFHmRmkD5M1wMBf6A6MDQzVVanm0Yltc/PRv2gfgWOaohZ5YUfZDQNbUjNHpFzSnHExPtZQKLp5pCTHm5rV1IM0hWHJgF05Lopw9QwotpjQLEBjXdkwU1U59mCcyQiReSNOrOkuR48tYeQlQzI1nzgf2GU78IZWvK0b3EcTZE2BE5k2/dm/XRzmCNqHvUmhIaZsOL+2LsVM1dMBcH9Br5Q1e7GIX406Qz4kftAnEYojlte/toEQUet8tju/wbexC0jGrRv2sDE8tQ5Eozk1RXkBgQA+3HWPke0TxmGHRwYmFDxtgRC47Paf/DnwOoh3hDwUdD8WI1cqF5uD7JMKbIpFskFNxD2ugHdiOwkgcPMMcb5hq57DGyV/8KAjx8=
  # AWS_ACCESS_KEY_ID
  - secure: SOvKTzQ+A3O+8p669HGFqpb5FTmym+RvNVyTzoCQ/Q3KMxWlAdbDkEOdfscotcm+kaOvhE+gtcpmPdarxQ93PkSusRmsHf1IWqwJ+GynO7ppjzZn5ZwIHzygIJR2W1/lMNfIZ0igWzJgBm9QDMDjCKbzjTzjlbrt7KW7jokJju2BdX75/tc/UMkHB/TBWYLSILWhrflxs4rk+CDsvDW/V4+pytRtqRtHgzUJkExjLQR/d+95+AAz/3y+6YQYjM5AmiAf1dyHwz2l5R9xO2G+9SGHnKkN7S2oObaSNoU/7xtwNBX9bsFmq05BIpH3VQkFp1dzNbOTOTEkdw9zUNHV7zri/uSFdITDhDN9kn76QNgYC1vBGT19xucr146fEyFpGs2+tjorJTHjqEI6wa/rNIA7AI+HfGfgOA9AkwX2Ed2xXiITaPNCQ2wyi9TThdJBNeidgABXHos4tZ1kbn/t6IHeB5NlzI0tOA74VicM8CURhCDr1fkMQTg0zitgz/7SUrU45DSzibrjqpq58L1dfWlIrOE+PkOlpe5ElZsoQrU1SvzYpXsEauM5oKNFwbH+3eK/X82YUnlnajxgZXcKa3ZMeJKnX6NI9RI7NpOHn2Hbyo456H0NiNAxpZ10o9bk2rFC3NuXbtfxv9KUNz6vICdT0IlyW/LauoAhR+/esCE=
  # AWS_SECRET_ACCESS_KEY
  - secure: c4ncfi0BGDJhXBVt4/gxiURqgFdwVZVOJ7AFy8GSPdu+bIZU/KksTYiABP6S8x5umxqqDKEw+RtwglhhM5/7mukkp5kny7hRtZwjr1op0O7ndaVN6mVue6Lf4128WSqKX8oUgYxDrRrxk9GHUDqTaOQiiXDK2h0xoiovpqa58JvzIOxu3BqinH5vj3fZv0aKUBCms7EU6BYwTOz63oOP/Uu0AnF1yoKVqbAzLCWvBsw4sapuhPKdPztxlc7YGl5HnUZ10tTpsaaSYfDEd76irOpn6UkuR/+Ty8j1WHYBhX4KKPVtHLV/79CdXErAEbMwYYOlkXKRRXIR8wufx94BgJrms4+Q/VfdX8dP8Yj39cPnWi1nWucBMGZk/mas57EStywG/5NoGxWDn5QWeHNMwqzXi6K7z9Hno1Ka6+x8rvQAwrb039Rzbrcz1EKFdG1GReYtXEflmfhYgevUgOlzcMM7iBRsB9RZFtw6ixXF2SrWIVqlUtToc+5b0flSq+7P0bt1BcYjbe48q9tq1/6qDjHx2CIuiWxOlMc9g8u5QhJBIGj0UvSk4GzQZMBX9h/Zg+6XPzIAmBIVmhKja/q76hPCUCW0l7tovb5DNd9jCrEV/YvvvWOYypWg3/ZrUPeC5N1h071MliedlIcBSfmRkogCDd/eLLgGd5ha0dItuEU=
  # AWS_REGION
  - secure: ZGawUosWobLY+kjeqp58Vun8nKpOAdOjMJoxn2bX6vrJD6H8rJrNFgCCxDkcM60EVcfcE7+RELk1543UTU3NSbXJqx66XExPTJyJUYM4fIGDIrDmLqlhZleujbUErOoUQ2cz4KDLa4yTJM3/WuiOE8dH2RaEEVyCT27da2q8H4wlt14ge33jsWYITJLC13ye+5MT4+GB+De++nelpNpMGhpc6V+y7aW3D3+Q1+p4rDbv3pPp+uONYetuoi1YRd/rICNaDhdOObZSrWSyfv7uj+aNt5DmnY0niz+zJWJaPluLiw6YQu9pTHOF4Brrm7w2gCs4XRGh7EB1gnxNSoFqQvZTC9Dk6bzcOFatgrIgVYHKWh0GVHjdXx4uZ6kiT6M880mAzTCYXfxQB134TItFlEDc23w1ds7QD5drPd6cRpZRmHBDTd9om5bFMVemG/+E2gwPjwDid5ZuWOnc0ytvU5tiGA/MDrXZNau2eiZTAC04eP/IGElPnEGQYn+F3l4OfgWLBceHk45gU+ear1xNiIYYF+6adi/loKFgtYI8pMYxjduFEIhM/ccvULFVllYN3xib0YO7l2G1T3yLYoEbavOGEM8ff71EvflylysS1F84sDWfnUSZ5LSbFLrk/FKDaBumi14XIRnvO1u9Ytxee5zrdPiOFkjaXcE6p3o5WEg=
  # AWS_BUCKET_NAME
  - secure: z6ip4pVWWdIlDxzEw7kSbpLt4uFG6RHI4hUe+/HPXL+AsXLppkkRp6yAv74sjOWCGMoPvPKzDtkIpV0571cieoLj1cAdJncHYgzWQC31LFlPUsswAHyXFD+OkU+3Hh2K8hafNqW/5x2mlBknWciU78XaLoP1OGw2dAQdpwbY22OHHf9Sme8A0vBwM0wdnbfHIZldRx2pUzG86sVZBm7+Y/1ebhKtvmm1ikGDQmk4vf45vdz++nFg6aC7cn7HVt9rEwhX9vBVtGiyjba6obpuUoH96xlfy881C4d4jneIJkVmH+eO+nLzuzC9bBG8gWt8T1IptP8In+y1BImfrSMTZt+VOWb1WxEeiuYyYx1zkpaGya/7f5pdVS9rxtR+DOfP6UvawsV2szfG6bGaTYerOtqyoRjWKWkx8pdzgA50/7taIYQhX+lRBsbP141qPp7NrpOCWsv78Eoxdrzu4SA09QwjH7UorTVxTO915R2P4bcofdHFFSaDsuWP8M9LzX8HdMN2fTF3vuvigxlykZL5axs4tc2WzQ3KxAv5eJW6zzxALNgLIIO6TR+O+oP73UExlL7VRsm7nSwETcdY9Pq/UkiwpdN/2JdGzmwui5ldfrFI0sqk4+R4O/Iqr2GQX3XrC08IVn8/edjbjeeZb2AW/xzMi50Uqh87/BTUnE6lZwU=
  # MAIN_WALLET_PRIVATE_KEY
  - secure: fvXJ1Um86ntYqciwDWam5dlCTsj5AMwTpwIWeMgUWoujvvhiv85hHNSssHCT5ns7tWNHe3u6wswEYD8XrYnNiwKevSDfb/4kmONmN2IoksUBdGSASChrnnkGcvgtdIQ6hZLeG5GNYqKMklw7xf51e78Gm8qMjY5oKn6GWj0j/IzZehv79bJt+qHpONH5ZXwTuFO6uhvEQaNKIl8ZyG8+ncBp1QAJOpOwNBlXrC/6hyXhttslARklkbWjD9Y/OnaH0YPQ7mPG+DbTZXp8WaysHIo8qkLb5/Gx/H9IwpT5hqU5KxEhLKzovvXYbKMUcnO6BW3mumSbcAaCrSx+JAq2H7M5wyLlrH4UZocpH5sNn269NUoQrtyKgpaZYGrSY+W9bKCA/OtEu5etl5+abqRMQbnhfFxyRxLCnAmJvKZw33M1K9omRS8A14aDtD24DgAkKp+o0PU7oAzbwxVQpNQ4xWC6phlRZu1jSqOYeaTgCSmW4Idj7T+E0OiZV5YtmRBi39wQe9uTQze9FcNAzRrNVzK5leMVLRpe5KAhCFK8QWxvBpIX4l2WOxFROg9kIddsbufp1QdxE7WUQzh8L74KeDX1bPtJvN8OzhrWoEksCRU7Z38f+nH5nlzouhkEEtVcxafULztU0CjTyJAakM3WOoAKoD11KfEs7TU6cKh5Egw=
  # MAIN_WALLET_ADDRESS
  - secure: QtytInEjMG1xCZGRm4M2woJz8DJzc+udhkXY02iDPjp0sohU8aoOPXXAe47FKzz+jN65x/24BjO63ULal78L/buCc5nf0Q5DhyCA/L+H3LR1zMkXhtH1sH+um/o3Byzfycfi8h0PpGK2bwSMm9H+FxV5w4Ou4VdnDZHbF4fVmxKYYfbDf9sSFyGcqFxzy6ycJXFAa8MeAegspupPC0XWxpgCBzSsbQ3P5GIHw+1JN0FW7f9Cwbi6KvKUbDMp+zB9Lj2z4oSKbcJ1khvSKRUlPehj6Iq639Z7JcElDauV0PWa094MXV8e6/QdfcL9nD5e89gCqNQuspmvvO8BQAlxfmRo3EaGCs5b674A4rOhZht+BMfxekWXIudN9ULbFGbHzxdO0sXlX0RCzxnQGcReN0yuwSKsqSEIE+A1CMnD0fboRoxatvBPuFv/CUtodGTF20wYJZJykGS2XIYZBLrf6vrEp3ccFkoMVCfgTBCPS0gewPFmxIR2l12tj2OQ1G0tjWSGayQK0l6bd+ScDXp7MsG2YaeG4VxFKwtcE1zXRrdoDYxqz/61y9Pgzo+HwfMECgEyGMexOExzX1o7hV8fDGHZ2L6ZNIxyRn1lzBZgSDcfpyqyW5xZsUMLWw+1Lt8ztEDnFi87mPv4RgHA02M98FxC5zWY6Ax05yPcKh/GzhM=
  # PROD_DATABASE_URL
  - secure: Wl4fMW3RHBlDPDBVzanW+osKnL3K8r1soRhneYA66H4JnEuydmoehIE16SBdFSJTB/Y8/c++MIyxUGq9QgtY/c7gL2qaxScnNSfIrwLU+zvWFrNwltJLL3o63OUuVdnHcX5jEgt2iWAIx4glAW7JEn/TF5zgf/lOsNF4zVLuVs5twUW8Oe3XN/yrjjL6XVA5Aun6ek0EpEthxHQ1WelaIWFDE7Yvvgp2+YXbihV3tmF9zq+gkUVpRq2q6aAJ6m4M5kg7B9S/n/BcEaJQyOu2OqoU7Xx5skgZ9cWwLwCeQ3L3Sf9Ag+rfY4qyjuKL8cgsb1FQczDJDFHHLdEy7VKxkFk/cTuGTQsHTtUbfXPaosSUL/XxNOXCek+tTc0Z+qSDUZOLAz6cm8CEOrVEm8ZBMIyxGGdA8s0PywVHDK3Lq3JXnkRWKQY5DCxXIWKE/bWZPmBuljtUcNuRTDUIymHTQ7ltZUDTp2tMiAN3pCqGQnm1HKqR4NT6gPfHChkomIc5NW4BtKJfUS+GdycbvxaWn0XC9P3bCqmV6PVklPJkQ1Q6FSPxYM48AJcZv2Uv+jXXwtXsCb+Qka+ZltM3blsYpRnb1ee4xO3frsbsgDy6ZOw4xMBTzARs/iFWwTa0svDFW5UkYR9f0Z1OjcE8UaT5PHIH550Tr3tdvlrV7HNm2fU=
  # TEST_DATABASE_URL
  - secure: i8hogCiF4HD3SWK0W885pLwitJcnEUoxN3G5j0RD5GmHqitQ8VoAz0Lx5KMM9U0Xupo94NGOmpt7/2CxkvsF0548OPSnBtcXD5GAT2cbCdhgiNJYDfBR+x2H1weUQrtjQ9Sa6tH7v/kyMt/Ku5ROzYhA8m2v0SvT2LxGareCeZZMVYlXH5TaH85pcWM2ugt8abdQQq7+TEEg0uoXK4zpWAi5p+xxTvRXbFe5o87cch0rk6zAYFDIoEd5XVJusXPh6+c79UusSQ5+pDE2Kuhi8Q5drUBJAf/5zyreugbkSqiLUopwj+Cez5EBRe0rvfyiHq5Y2Up2l18Vq/04rzhqBxI9AsUdcs2UPxjUnswDWY893csViDyKRqK3s8IyIrCMhmtxez0Vp181vA2z9s0/lok0zAHhv+OO71H0SDztDbNe4z7Izv8Cvt/eWprkKrkMnMnJ2kPGrvL5eAyAvsQl9RG9KRErgHMuyQQyvB7u5U545gMKQtoCsnyPSc/mOcVeN9LPsTo6kqCmio+KiJZbIOBV0ANDUfcHNbcVvOE8ICLZbK6dCWELzhb33RSxTpmcqQxBrOPFYdD0AO0f+SVM7/S7LfhqVwhlNJeRbRsHM7EkQXinsD/gKTuBLe+yY/smjz9kSP/JemrTyCvHnFuaIu79ob9SeqT5Hnm3uTcyeXg=
  # ENCRYPTION_KEY
  - secure: B4OpQOK4bTG89zF2xHoxOSZY08tPWeIoIRnABM6+B9V/zxH6dlAQa4rr3JARku5AtFNqD/GGxFSw3hf5cjWbnPD+skleEEed/VDuUZJd6iL8WOEu+LXUIOY51ePnQZ9C04VvfN77mfgfVvHURjulIrnNpFP7FvhIaxguR5sXS4vE/7qWZ88ExbeuJSrP/ldQH3+WamwVtdwWeinWCg8pVJWCCNDxA941HlEeYJJWbhWSCNqMn6ozCe0q3tAMJDH41/vgI7lYIpwgrv419xXx+33hvT3DJqLUvq90nLixBm5walco/yaoGOoe7Wz+scwaiRDZmARdmzuRF5g582VyB92MfUO5EDfBkTDxlntDnhKH1ycifyQXiDnx3I2g218et4OBgLj8cb6JmCCmsX/zEkLUW25IApjAMGaHhDUKqWr8feH4RFhAjwp+xxM8hCzbFnSTBAFa6es1SgIbgsBzKdTeEveD+aGEDPjywbZuBPIYjUHj6ax1J+7I6ED9iwIq4sDnuZAOljHpJ3nKP1DvFuhPDod7/VsC8n6oCPJE8PAvpt8ZYMorkPDW1BBSc5zQ0+ajOcTRY2hHi+Eo6ZaHLvCfOaV2OvQ/MBf0aM+XJU32NO3FpaBRLwOFseHeZrNA9J8iCt2P0ty2MBDQe90dSZv50m1Mo/7ffcZtZ4ezDC0=
addons:
  apt:
    packages:
    - docker-ce

before_install:
  - sudo apt-get install -y -q netcat

  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - sudo apt-get update
  - sudo apt-get -y install docker-ce
  - docker --version

  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
  - cp .travis.env .env

  - docker-compose --version
  - rm -rf ./data
  - docker-compose up --build -d

install: true

before_script:
  - echo $AWS_REGION
  - echo AWS_REGION
  - echo ${AWS_REGION}
  # - "
  #     echo waiting for docker...;
  #     while ! nc -z localhost 3000;
  #     do
  #       sleep 0.5;
  #     done;
  #   "

script:
  - docker-compose exec app go test ./...
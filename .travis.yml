sudo: required

language: go

go:
 - "1.11.4"

env:
  matrix:
  - DOCKER_COMPOSE_VERSION=1.18.0 GO111MODULE=on
  global:
  - DISPLAY_NAME=travisBuild
  - ENABLE_JOBS=false
  - SLACK_DEBUG_URL=""
  - DISABLE_DB_CONN=false
  - ACCOUNT_RETENTION_DAYS=7
  - secure: xANdj02bohV/1Em62FVvo/6fDXIofSokNMnLI1hVXjU+zrowuMXytXlGSVLDip4mssuMbjJUHfJiCrpxkqPlqDwctCVeV+4A0EtBDt/io1+qZ/x7tHfuq91i2Ogholdr1uu5GGx2hpFzpmxUw+JnCEKG8cfIrlQ5gO5924+DcHnJCeggU14L+sD5WHozi8VbsChFKI3m+JoP248PiNgXrjZAUIXQ4UXOacxdnEHRpahlNQpjUQvv2ipUvcCZrruPZOJLzCVRYYSGwoLg6/I4MvxYUpfxwvEvtWnEILQjBuwlCanZFekyn1S7kJTaY9UTCbCQ9lscUDxkDNpz0zRYlDmFV4IpM3E8dV97vyVVIUMEanCGyKQH6XzY1S4Eg52rsmqIPNTjRrL4RWC0wKKGA2S11vvRycdOuQ3yUa9iqbpxc0rkk73J/aD6xfOXQZo9shAkVvCGLRt5Cd4HSRDZIFdlcfQdX8GGRGf6eihsZ38SIx+gIS163DGqWqnnOeOTWuZAF76N4ttjxZTwhoO4O2bC+G73/zrAOnrq44z+NK+eqvx+lKbMDq1WooKZLbDCp1YjhLJTfPbI0HneVnWPmICBBxK7xxbwqv4HRtfLOMc7Oyrbtdni64jQhYTBHmV8jFxWIbi6KIsOHBxAZr8izKC1/FCrQBZQOic1VD/+RvE=
  - secure: peD4TLgAdh9WZdTfix4JxUuYZmuvxofGMtv1DhdsZmihRec697K+UyAm9flF2DeYAHadhzkke0vm/r4X0T6dSvVSQxqugmxjO3uv3iUb+YXRewq86DyNWYzOdEeubEPNBcfmlMTTGzPVhPsyTb+4+Ifnb0+9h3sVYHMT43tm3zezmu7x7QKGi4en+USpya8aZsjP7zRx7bG/3tSA7/E1xALWLNWUxYon54TsqTBOl61S191g/xoq2QhzUHmyHsmetQj7QmVg4Km80WkFvvm22FyvLSzllfZucyLHr6/7lkHjd/cuIhbdnSJLsBhxOeed2hcZoVxFN0BP5bAPV1qDsqkNEkMln4ayC4DkbgpZAzozClw7eOHIlh8ZRiaWTpMe9uBAvrMS/reaL0sUTpbRXS/BHlzvCvvdBgn9dpdJX7WTM2bkKiHtkedAtob8ePlbXUZBgZ018Gzd338BmBKnJt3j2jTOkYWI3GZVsCseu2UJpcEOtYMIa9Eap+xfYSdIGDzMfPAPGZqul9qRqxtcU9X3P4RO3jmF3M6nxPcCDF0e9HzAaO0nI5qvBI2+jEONUSdfbu4bF0TaNHh2KhrJ1uwDB2ODmEDf/wRaq9nKkgbx44/4NpiDFi4vIHuKe/P3qBvXnXv3D1iw/Z6h54I8Y5NG4wiTe6CvWlf2/Wg8Ke8=
  - secure: m0Gi2jWdFqg4I1svXyllkCzdRxZcQwhOtteKIWdTOYVNlP1/N3NoHUtxtW6i62Rrp+VEelAyIqH5sKTPR95TXf/tz8qfRm5CI+WkJNRWqgNyiY55nwaHB0FqNlbrutf+KTUOe4ZpxFHLh/K8X+V+ShsgDzm10eUWxM5PZWIzPt2BtJQA0Kbr1mRwtlo+txW30fcXrBGEDW2ZGtRgeUaVZPMwIdByZyPhb0DkfeT5yhggf+PxmkPEzBtEhgAI9cY25CK1UZ80qJy57vEMYNoW4dKiFBPN0REV1ubN70x74W7JaUMre9bBJyRaOYA/bSpq4qsmxrphKF1VN4mXc/TfArNIdQbGIuq9IIQTmgNLp1JXorJv3W2emK+vHqe4gRJHGyDOo+9sbTtY4RV/ozFb2XlELg9seP8Tw0PLUeYQ/TXoUbxr7pXKl4nQgJ6vb6PxQwEZlYzUXix3e6tNP0Yc2Filxk4jlQyklzeyH12JtG3LoiREf4rcYrYOj8qGNgu0YunKCzksDKNJGXV0dPguxI0jPHvpB5rPkze+6+aj31n/8iUBg3/Ij39MYcYpEuq1JyTRocuQ4Nsmsf53Ji2FozZ7qh/ia0/zfewHqMDskyhUGRLJB+ilWw+Js1ug1aq1wRUqMSv0/K7WJgne8lP0gm5vwl4r4Fx8PLIGfyraSIs=
  - secure: 0i6or7CwA+8BLpoq85ZJiy3u0mWJqL7MvUBxHtJplEt+YDjrp+ECoFl5OkPqvsHGk2LAkgMmCAle4mem4datLFTFpBwbFn4In1XzlYefIcHBcmkUp0g011uc4Z1iY2I8Slx45cq9DaC5dockn5JDWY6UeCakPv/PPQgS4F8vgB5sfYMldJhpZGzdDUWenMT985KoblzjIldHaRA6m7b62piR4p1SYXNPNUZCEr6alVk5sjY382YagW3FphwX9GahwdhpRHOsvqY8MQXyGci0fz1lrovvOjXX6v1t/6nKwDZ5lLXicZBLdYsQF0R8dpmDr974Tsy1x7zLu7EmG4mIzqSVNizE4TvbdkaIQcBEIqXkAOxI+K0DS5ZQgFxwSOKlnkd8zDIiRy3CQga9b0N4PXl6v2Y36ZActUMQOYXg1u6WVkqQCSa+Gpaoa1JpbC8XTgWqK1hA9LfCTx+tra0SNdgbcvCFmb96/Lj1fl/wSdlgieN+b0AxKy96a4dVJMV0GFiFdVaIzUQ27SeRRKRzkU1acoXZQXXgNcL5wc1vcqR4jRehMV8QkDc3nJBsB1whvgDYVGSuH6zt2irJ2fB8eW37Uq2Ww6Wd4Wal13lammPDEr5lJFJP+pO8jJXF4Qtop7nq8JMgCmhOpcK5tccy8ZpzcscPUTxAqkcjnOJ/vuE=
  - secure: vfYRo/PNypIfvaUogK0EMdJslrSnnDpd5XucJ8EowU7+yPRP5XuHyIbcIaMJBFjQNp/COkakjeo+VrkHv/jtOQqPimqA/MLTBDJfEHYd9xyZUh5sd5geXQ78T+8gu9CP7Dsgm/kU8kQqvGJ0xtL9JTqf+NWCsDNKuvwRhrPRM+Q0BayqXucdmq1Y2gXQQ6zilOu4+GOBY4nVruafDWIF7pfGaojaJwij01v0/qUqwf5Ou8ZJVfwGTtWVFXGSHsUZTpvOX5tjrxDZEgcjgX6VFT5A8phJ3hLZlZ7aufZWsHOTIKES7O3M+Zm+5S/XI+XSRIVBRORo1PtI/9haHcgl2Szr0kJVPGUTPxFLBnyuzoXKRVNxqdTKzi2sWZcVKxz5S5s96lMzoaKovdYwUWfGt1TUO5dokZn02CHtSJnsBQrjrgPoQvTavj61c5qSydiY91k7SrhEyu40jC1bRm9aUHb9UJN5t/Pun+uUL5Ruzdbjc0GYnowZ8f1iEZgFNVVoSfiFz8pUYTR/w3ae27hxlv3ezkS+r9WP0sLJZ9cMc1XPH6VCzmjBpOcU2Z/LMga620F0SXbc1XBBhnXTaxONzJQb/Gts/dSangVGlJfpITv3DTTZWgFkKd855xVDI3VmHW5852wm99q010JxYre0wwk0SHEc7wCgUQpESW1HIjE=
  - secure: tAWCkaecWmYfu8FENg25mZH8R970F5QabKooInSWR8+VnDfR4x/t7kdQM/GgJeYpXRI8gVw9Zg/nCswqCD9OqSHqN+17fQvUHpoaGSMXOLMIsnAL1CyPuYbBMp9BctnJr6vxbLwXTaerOQl/OOHtOmkX9E0lhb/oVxF+Oyf8baKS4TmispjbttP6K3kxGQBrx4rGDbVXO8znZ1tistZ/18+zaxTh2xLHTKXewJ2LzZY+5H+VMX/GCyhe+d7rglT92fHpNIXTJKwB4QPsh0KcK1rOLCL0ZkIz7NLdgnl41VtzG/g6cQZuVN4guRFHsg95efIh/h5VenEErMW5msrY7IDzXhlnQzKW0CRd1ojDXDTsJctEDBdBfqBa894+Fhl01kjLOfm2U3ECSraV/tqiZ2YAussvgyydRpF6+f+jGxTJruLseuU1/93M3rtLc8ylK6mcCg5TCBINPc59Gp8gMhrnsKCLlmqwwpCWkzDdx9nbipur0c8ZsNAD2IcAw4nf4PDruwK5X0L7gakaS03lAu10aqYurQgHNqxybKWm5EWYAFxNMoDRMuooLkZd1BXpN/0cujns390Kpcr12h4z5uZQCSRs6rAYbeMCsGUSx69XXlwIqyyI36vKN7+wnXBjWfU7F7W0SkpkNFEuQB1i+SmZH8i8AV+Uw4IBP1YG1Ko=
  - secure: jk7sjrOCXEVHrua9QDnXWiKtowqtGYPT2adJB+x4WosQyn5KA1enitpeOQgETfEMbLDOP9kEJa07t+UQj9vZXcbXOZ1/j8xYIiVVs7PA4Soc8lKxFbFdnWRHLxpGKtyzDEIkdtDKOWR0gleRZbTPySv1qQWCHFCZDtSLl3mueyG/cmPOItMeCmVKOdOeBcudFu+U5U3cHzpi0iQeeeGg9TsvwOa7XNkLJ3aKPsWUlnAEy1YH8o0gCd5jS7iWriA1n61yY9eEAJXphzOauuCNmrzXbiaz3xlNBeHAAWmFnXFFrxg+TN55D5eNemmSrjREpMhVJvt+N41elDXOdyLhZpWM991D3veULBLfQbHFeHi5sbEPZS+6Lx3/RJvLrkh5afzo0XVDD+nTC757JTPG8bMx0kErobrEj+Ky/X+XQSoseI/X0Tah5VIfr32nrKzCXvVKgdvQCM2xwRh2D/iLbwNbNzyuLxmFT+8vD5KrnPX/zg+goEZ1rmj+aGfxzGPpT2zmkneDw2J3ChEk6bDEE6Qb4T6iT4BhBirq/uPThVu+LCOL/3vfWICUzZp6XYZKndgt/FwFK9yEWixrfHHax4C0SjGycNEhDLAc0wlCzE7Oq+d1lE+QUqVdyohmKxao1xAyoNHgwfKfZhzFU/417azRHDgEwTV5MB3J/UUBq1k=
  - secure: FKTYB0sUpz6/SzhAR2VI7cWilZ6dixJ6Ax35JMCZDTO5yIttCEzoFWZQvapuqBcZ2ZFIIoxWpqgc23FAaVJFJjCxiUjHzSP9A+sh2gK9NJGmztqqnWZhFVp2HHPII9Rwpr6RPCkLH1D0148ZRaTRqX0FTcC4lBPlVBQLjmnis1UdPIeXy57Q65ZFQAa+tFZDYmnLjMvujV/bDKCTl0VXX7fDjy3ZSHuXGiLPWaG6Mq8vOFDC/agK8B7SovfPn7hHatRAr9uYm62RqsVJZRQQkr4lcJTGcgsv5PKPnhiUyMSXeG3/3gdhhcDo74nBUTuYWEtDxnh/8lkYl3fDJzCpPEuvG/XhhjbHfUsPSdwFvVt+NxXr3DneRerZHJNq7cFhyXuPJetu0iZnZy2T4yv35tGMzzu6XVYsKig8/aADIX9vKsCrPoC2y6jCTfT+rFlIUnaqCVgJdFiLWxaS6cSuwrfBWnnoZJ/9mesiSmhb6UfheM4Iq8cjjFRgwEB2o5c4PThbtjNdGrShi/HPdJuemPppM48+YAQRNwrkHx7ZweJtyGAeC61y9t99CrdsdwOaqmHtx+XnIGAj0tDnGRMqHqd4af17E13OkIJ+tsH2yklcLD/VCeHb5q5q0BFbdOP4J+2MyN6AFBiXmNeD+KzdNIZnw7BP+2+rpYKnxzppmM4=
  - secure: 4zT5+r+sAvY+1hIKMXbr2vi0K71V5OHbXkXrl/CbywvKJ2r0ZoY8Iu/WLuQh6gDGjobmAVZjG1Imoko9/iO79DDHUebKv7mxak0gkGAPUvCb6apB3atAVuqaVo4mRGRz3T8mHftbHkAs5sQQJS8K3Mte+ILDIL5v2fhBl57mpHrvMOdvZsYnRhyEfAxrbJhWt7vTAiTR336U0tjKajLkZQbFDg8MLzIRXBGDJtNSFYsnpBO1/shC/I0KoQOh7tMcPB+XDPm5AHpWFp/IaQZJIBWZwqNEL4EAPIcYBsjGc03kXBE/296X8wbZsKTr4v2t41/bi3fblKf3zzR72Rl0q4ydcHuNS2y3cC9ERtxcQOgcJPYPLbmDPLSODqpDfRh45Q3RPOMfQakhMye9FsmyberkyS7a4vzc1ztCWTB3KkqdK1Qb3hBsGup8omL/w9tRKAPrBc4EWUUSyWf3DAINFRIT8c6pmzlOO1KSErJwDoAxvyPuMXZ52ohe7eD3yVrDoZL7OTiXpK7ZR9M3IEaenU/BBkariw3Mnq4kucsnY5uDDPX+XrYjhJXQ/0ouy8WRRfd7fZAMSuIWypcDkIrtrBz5UjwAr4cQOwU3nlqeP1SBobgemYer3HKvtXf5TjxdeUvx3tHvtFWMCxWCQTDirTGwJ4lpm7UsIpTNVKdUMr4=
  - secure: ci3oKfAFd7J5teTEVlJI6yfMIKRhOLBmbIdpsHQ6oaHG8GFPB3vSVJwFvWk6RU2qKENN9ikzlviKb4hzt/q9CsBb02K9y5lZ5XE0WfH3idmIaDFjO1XeoEF83NlMdSePariEk+dPUFSfgbP+bWjUX+i+BLWFVs1ShqN+zoti6udBK/TPc5CAA52KeYqH7FR57XsJzxzZcmyjW5WWRN55Qic5P8FaPvZ5DGUEq9q4ZLMERKnOupTC7ep0ozZtduKkb752Ys0n9myP6Sbw9atrl0U6y9ffj6yGgsxyRjzRr8+7GFTZTDI6x3xIqtzWYVuYNhXDYWOAVwP14VWGscVCI2SYrdEbPFHoU1Y3H6TLOtS84Ap4sOIV9/U6ZSdIV04Jq0EeD1H8TdasMCFi3DOwFK52WkpD8CsRc0QcvubSIN8kkBTXaB+KUDPtXQ206bifEq/E0WFZOiBItXC5sepFoHpoR3sknZVdE6oJCA9slBw+LEvU963KSMVj7aew1zLOl2RwP90lvxqy5yG8k5kKjTAGcptahHUttwBw8N1yeaO+MpIiykxHTkQS7fDhki54eKtq/y95JC8EPTMRNyzq63lUiF4lMDeyjeXT/Z/N/rlnbQei6M7vOYTfH7HG4BMrQXmLo7dj+NeE0XOMk2Z1Ft00ia7OiPIjNwfjceSHUJ8=
  - secure: Vo3zuPngtenyjM/vlIaliBiqs9nCq83QAnfK3LvgyGWtKl4IH3TYZv81uEYaqBHwEgc5+4fVm0s4vYFcFn/s8dmLcA75VONGDIJGIUdHVE3E5FF255CLo6L1PrtTSK/zxGGlMQJWjs0SCDLO+/cr42Zu892rWkh7J8ssHeguqd0eGHQwtfWlGc/lu/hMp4k5oQEJ3KnsTvUchfkXv/CWfWwQ5MjfBPAUx7n0FvRHVBcULWQY5ZUSBeZDz6NUNz39MJ0qHzXNGIFPy3G+9GhUVW3MxW5xIW8Hd0FIhdQ7HRmJU0ccSmHljb6sT8A5o1u8e25Ta6dfgLRahAli6TsWh8SH6kvAwP11Jq1J6esVLRFB99yMha7RDEwWMWadvilGtqK2qS9Ej7Gy+hRxveeHl8HPIXgiL568NaYkr7ZVlojGFmbHeCFWp3u+SKpvAMm1P52OJcWvaKshNsnvOnBVczXFdLT3CFIwbT78LGBQIMmeR6PHdzG+3FqPi0GSBUQ19MklsKfsTxYk/LJFqhYQFAUtBt7FzGByTZ1YEp4O1EdVUUV+LpiyIxAKxqhCImsxOjahZ0Ie226RvFDCbLPaAsfO+s4yZ4+LnW2Xyc0xL2ZVhQZZTy3E+/JWUAJIbbRIDxaOAa/WHIKT04MGUdW/YdltMcnVEb4GbkZPoy0eKyQ=
addons:
  apt:
    packages:
    - docker-ce

before_install:
  - sudo apt-get install -y -q netcat

  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - sudo apt-get update
  - sudo apt-get -y install docker-ce
  - docker --version

  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
  - cp .travis.env .env

  - docker-compose --version
  - rm -rf ./data
  - docker-compose up --build -d

install: true

before_script:
  - echo $AWS_REGION
  - echo AWS_REGION
  - echo ${AWS_REGION}
  # - "
  #     echo waiting for docker...;
  #     while ! nc -z localhost 3000;
  #     do
  #       sleep 0.5;
  #     done;
  #   "

script:
  - docker-compose exec app go test ./...